{% extends "base.html" %}
{% block content %}
<h2>Message from {{ sender }}</h2>

{% if mtype == 'text' %}
  {% if ciphertext %}
  <div class="mb-3">
    <label class="form-label">Ciphertext (Base64)</label>
    <pre class="p-2 border bg-light" style="white-space: pre-wrap; word-break: break-word;">{{ ciphertext }}</pre>
  </div>
{% endif %}
  {% if content %}
    <div class="mb-3">
      <label class="form-label">Decrypted content</label>
      <pre class="p-3 border bg-light" style="white-space: pre-wrap; word-break: break-word;">{{ content }}</pre>
    </div>
    <a href="{{ url_for('inbox') }}" class="btn btn-secondary">Back</a>
  {% else %}
    <div class="mb-3">
      <p>This message is encrypted. Enter the XOR key to decrypt:</p>
      {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
      {% endif %}
      <form method="post">
        <div class="mb-3">
          <label class="form-label">XOR key</label>
          <input class="form-control" name="xor_key" required autofocus>
        </div>
        <button class="btn btn-primary" type="submit">Decrypt</button>
        <a href="{{ url_for('inbox') }}" class="btn btn-secondary ms-2">Back</a>
      </form>
      <p class="mt-2 text-muted small">If decryption fails, verify the key and try again.</p>
    </div>
  {% endif %}

{% elif mtype == 'image' %}
  <div class="mb-3">
    <label class="form-label">Extracted secret</label>
    <pre class="p-3 border bg-light" style="white-space: pre-wrap; word-break: break-word;">{{ content }}</pre>
    {% if image_path %}
      <img src="{{ image_path }}" alt="stego image" class="img-fluid mt-2" />
    {% endif %}
  </div>
  <a href="{{ url_for('inbox') }}" class="btn btn-secondary">Back</a>

{% elif mtype == 'file' %}
  <div class="mb-3">
    <p><strong>File from {{ sender }}</strong></p>
    <p>File name: {{ file_name or 'Unknown' }}</p>
    <a href="{{ url_for('download_file', msg_id=msg_id) }}" class="btn btn-primary">Download File</a>
    <a href="{{ url_for('inbox') }}" class="btn btn-secondary ms-2">Back</a>
  </div>

{% else %}
  <p>Unsupported message type.</p>
  <a href="{{ url_for('inbox') }}" class="btn btn-secondary">Back</a>
{% endif %}

{% endblock %}
